# 字幕翻译工具

一个基于有道翻译API的自动字幕翻译工具，可以将英文字幕文件(.srt)翻译成中英双语字幕文件。

## 项目简介

本工具专为影视字幕翻译而设计，能够自动处理SRT格式的英文字幕文件，通过有道翻译API将其翻译为中文，并生成包含中英双语的字幕文件。特别适用于学习英语或观看外语影视作品时使用。

## 功能特性

- 🌐 **自动翻译**: 使用有道翻译API进行高质量的英中翻译
- 📁 **批量处理**: 支持批量处理多个字幕文件
- 🔄 **双语输出**: 生成包含原文和译文的双语字幕
- ⚡ **智能跳过**: 自动跳过已翻译的文件，避免重复处理
- 📝 **格式保持**: 完整保持原字幕的时间轴和格式

## 项目结构

```
.
├── according_to_src.py    # 主程序文件
├── Subs/                  # 字幕文件目录
│   ├── *.eng.srt         # 英文字幕文件
│   └── *.zh&eng.srt      # 生成的中英双语字幕文件
└── README.md             # 项目说明文档
```

## 安装依赖

在运行本工具之前，请确保安装以下Python依赖包：

```bash
pip install pysrt requests
```

### 依赖说明

- `pysrt`: 用于解析和处理SRT字幕文件
- `requests`: 用于发送HTTP请求到有道翻译API

## 使用方法

### 1. 准备字幕文件

将需要翻译的英文字幕文件放入 `Subs/` 目录中，文件名必须以 `.eng.srt` 结尾。

示例文件名：
- `Game of Thrones S08E01.eng.srt`
- `Movie Title.eng.srt`

### 2. 运行翻译程序

```bash
python according_to_src.py
```

### 3. 获取翻译结果

程序会自动处理 `Subs/` 目录中的所有 `.eng.srt` 文件，生成对应的 `.zh&eng.srt` 双语字幕文件。

## 输出格式

### 原始英文字幕格式：
```
1
00:04:29,060 --> 00:04:30,896
You should consider yourself lucky.
```

### 翻译后的双语字幕格式：
```
1
00:04:29,060 --> 00:04:30,896
You should consider yourself lucky.
你应该觉得自己很幸运。
```

## API配置

本工具使用有道翻译API，相关配置信息已内置在代码中：

```python
YOUDAO_URL = 'https://openapi.youdao.com/api'
APP_KEY = '5b776e062bbdc974'
APP_SECRET = '9XhyrhxDf33Zf7zsar52FXNYDBLjbrtY'
```

## 核心功能说明

### 翻译函数 `connect()`

- **参数**:
  - `q`: 待翻译的文本
  - `source_lang`: 源语言（默认：'auto'）
  - `target_lang`: 目标语言（默认：'zh-CHS'）

- **返回**: 翻译后的文本

### 加密函数 `encrypt()`

使用SHA256算法对请求签名进行加密，确保API调用的安全性。

### 文本截断函数 `truncate()`

根据有道API要求，对过长的文本进行智能截断处理。

## 工作流程

1. **扫描文件**: 自动扫描 `Subs/` 目录中的 `.eng.srt` 文件
2. **检查重复**: 跳过已存在的翻译文件，避免重复处理
3. **解析字幕**: 使用 `pysrt` 库解析SRT字幕文件
4. **逐句翻译**: 调用有道API对每条字幕进行翻译
5. **合并文本**: 将原文和译文合并到同一条字幕中
6. **保存文件**: 生成新的双语字幕文件

## 注意事项

⚠️ **重要提醒**:

1. **API限制**: 有道翻译API可能有调用频率限制，程序中已添加1秒延迟
2. **网络连接**: 需要稳定的网络连接以访问翻译API
3. **文件命名**: 英文字幕文件必须以 `.eng.srt` 结尾
4. **编码格式**: 输出文件使用UTF-8编码，确保中文显示正常
5. **API密钥**: 当前使用的是示例API密钥，建议申请个人密钥以获得更好的服务

## 错误处理

程序包含基本的错误处理机制：

- API调用失败时会显示错误代码
- 自动跳过非英文字幕文件
- 检测并跳过已翻译的文件

## 示例用法

假设您有一个名为 `Movie.eng.srt` 的英文字幕文件：

1. 将文件放入 `Subs/` 目录
2. 运行 `python according_to_src.py`
3. 程序会生成 `Movie.zh&eng.srt` 双语字幕文件

## 技术特点

- **异步处理**: 支持批量文件处理
- **智能识别**: 自动识别英文字幕文件
- **格式保持**: 完整保持时间轴和字幕结构
- **编码安全**: 使用UTF-8编码确保中文正确显示

## 适用场景

- 🎬 影视作品学习
- 📚 英语学习辅助
- 🌍 多语言字幕制作
- 📺 个人观影需求

## 许可证

本项目仅供学习和个人使用，请遵守有道翻译API的使用条款。

---

**开发提示**: 如需自定义翻译语言或修改其他参数，请编辑 `according_to_src.py` 文件中的相关配置。